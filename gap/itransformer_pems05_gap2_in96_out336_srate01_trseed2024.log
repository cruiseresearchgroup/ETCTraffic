Args in experiment:
Namespace(activation='gelu', anomaly_ratio=0.25, batch_size=16, c_out=103, checkpoints='./checkpoints/', d_ff=512, d_layers=1, d_model=512, data='custom', data_path='pems05_all_common_flow.csv', dec_in=103, des='Exp', devices='0,1,2,3', distil=True, dropout=0, e_layers=4, embed='timeF', enc_in=103, factor=3, features='M', freq='h', gap_day=730, gpu=0, inverse=False, is_training=1, itr=1, label_len=48, learning_rate=0.001, loss='MSE', lradj='type1', mask_rate=0.25, model='iTransformer', model_id='pems05_all_96_336', moving_avg=25, n_heads=8, num_kernels=6, num_workers=10, output_attention=False, p_hidden_dims=[128, 128], p_hidden_layers=2, patience=3, pred_len=336, root_path='../../data/pems/', samle_rate=0.1, sample_seed=7, seasonal_patterns='Monthly', seq_len=96, target='OT', task_name='long_term_forecast', top_k=5, train_epochs=10, train_seed=2024, use_amp=False, use_gpu=True, use_multi_gpu=False)
Use GPU: cuda:0
>>>>>>>start training : long_term_forecast_pems05_all_96_336_iTransformer_custom_ftM_sl96_ll48_pl336_dm512_nh8_el4_dl1_df512_fc3_ebtimeF_dtTrue_srate0.1_sseed7_trainseed2024_gap730_Exp_0>>>>>>>>>>>>>>>>>>>>>>>>>>
train 548119
val 42356
test 42355
	iters: 100, epoch: 1 | loss: 1.7982738
	speed: 0.0328s/iter; left time: 1118.8620s
	iters: 200, epoch: 1 | loss: 1.6795878
	speed: 0.0304s/iter; left time: 1035.8135s
	iters: 300, epoch: 1 | loss: 1.4688251
	speed: 0.0304s/iter; left time: 1031.4701s
	iters: 400, epoch: 1 | loss: 1.5477686
	speed: 0.0304s/iter; left time: 1030.7113s
	iters: 500, epoch: 1 | loss: 1.4675730
	speed: 0.0303s/iter; left time: 1024.1255s
	iters: 600, epoch: 1 | loss: 1.2433264
	speed: 0.0304s/iter; left time: 1022.0498s
	iters: 700, epoch: 1 | loss: 1.6254098
	speed: 0.0303s/iter; left time: 1016.1885s
	iters: 800, epoch: 1 | loss: 1.5421106
	speed: 0.0305s/iter; left time: 1019.0231s
	iters: 900, epoch: 1 | loss: 1.7819570
	speed: 0.0305s/iter; left time: 1016.5978s
	iters: 1000, epoch: 1 | loss: 1.4543620
	speed: 0.0304s/iter; left time: 1009.8883s
	iters: 1100, epoch: 1 | loss: 1.5570232
	speed: 0.0305s/iter; left time: 1012.0724s
	iters: 1200, epoch: 1 | loss: 1.7342535
	speed: 0.0304s/iter; left time: 1004.5837s
	iters: 1300, epoch: 1 | loss: 1.5129255
	speed: 0.0303s/iter; left time: 999.0765s
	iters: 1400, epoch: 1 | loss: 1.5902908
	speed: 0.0304s/iter; left time: 998.4696s
	iters: 1500, epoch: 1 | loss: 1.3397866
	speed: 0.0303s/iter; left time: 991.0918s
	iters: 1600, epoch: 1 | loss: 1.6270264
	speed: 0.0304s/iter; left time: 993.1577s
	iters: 1700, epoch: 1 | loss: 1.5450640
	speed: 0.0302s/iter; left time: 983.7502s
	iters: 1800, epoch: 1 | loss: 1.4513506
	speed: 0.0303s/iter; left time: 981.9673s
	iters: 1900, epoch: 1 | loss: 1.5776792
	speed: 0.0304s/iter; left time: 983.5018s
	iters: 2000, epoch: 1 | loss: 1.6942852
	speed: 0.0304s/iter; left time: 979.3402s
	iters: 2100, epoch: 1 | loss: 1.7138675
	speed: 0.0304s/iter; left time: 976.1411s
	iters: 2200, epoch: 1 | loss: 1.7165812
	speed: 0.0304s/iter; left time: 973.9224s
	iters: 2300, epoch: 1 | loss: 1.4652185
	speed: 0.0304s/iter; left time: 971.4977s
	iters: 2400, epoch: 1 | loss: 1.5648012
	speed: 0.0304s/iter; left time: 967.3825s
	iters: 2500, epoch: 1 | loss: 1.4963933
	speed: 0.0304s/iter; left time: 966.0081s
	iters: 2600, epoch: 1 | loss: 1.5002112
	speed: 0.0304s/iter; left time: 961.6730s
	iters: 2700, epoch: 1 | loss: 1.4782034
	speed: 0.0304s/iter; left time: 959.9017s
	iters: 2800, epoch: 1 | loss: 1.6116805
	speed: 0.0303s/iter; left time: 951.4252s
	iters: 2900, epoch: 1 | loss: 1.7107573
	speed: 0.0304s/iter; left time: 953.0483s
	iters: 3000, epoch: 1 | loss: 1.5032430
	speed: 0.0304s/iter; left time: 950.4016s
	iters: 3100, epoch: 1 | loss: 1.4230660
	speed: 0.0304s/iter; left time: 947.6079s
	iters: 3200, epoch: 1 | loss: 1.6370078
	speed: 0.0307s/iter; left time: 951.9093s
	iters: 3300, epoch: 1 | loss: 1.4857494
	speed: 0.0302s/iter; left time: 934.7397s
	iters: 3400, epoch: 1 | loss: 1.3654971
	speed: 0.0302s/iter; left time: 932.2254s
Epoch: 1 cost time: 104.34564781188965
Epoch: 1, Steps: 3425 | Train Loss: 1.5442761 Vali Loss: 1.8795984 Test Loss: 2.2069392
Validation loss decreased (inf --> 1.879598).  Saving model ...
Updating learning rate to 0.001
	iters: 100, epoch: 2 | loss: 1.4951377
	speed: 0.2359s/iter; left time: 7246.8242s
	iters: 200, epoch: 2 | loss: 1.9196087
	speed: 0.0304s/iter; left time: 929.7601s
	iters: 300, epoch: 2 | loss: 1.8673986
	speed: 0.0305s/iter; left time: 931.1107s
	iters: 400, epoch: 2 | loss: 1.7692969
	speed: 0.0303s/iter; left time: 920.5661s
	iters: 500, epoch: 2 | loss: 1.6178702
	speed: 0.0301s/iter; left time: 912.2543s
	iters: 600, epoch: 2 | loss: 1.7214414
	speed: 0.0303s/iter; left time: 916.7516s
	iters: 700, epoch: 2 | loss: 1.4794618
	speed: 0.0302s/iter; left time: 910.8590s
	iters: 800, epoch: 2 | loss: 1.6270894
	speed: 0.0304s/iter; left time: 912.2320s
	iters: 900, epoch: 2 | loss: 1.5909640
	speed: 0.0303s/iter; left time: 907.1289s
	iters: 1000, epoch: 2 | loss: 1.5109848
	speed: 0.0303s/iter; left time: 904.6778s
	iters: 1100, epoch: 2 | loss: 1.6541209
	speed: 0.0304s/iter; left time: 903.3389s
	iters: 1200, epoch: 2 | loss: 1.5696083
	speed: 0.0305s/iter; left time: 904.6307s
	iters: 1300, epoch: 2 | loss: 1.6831239
	speed: 0.0303s/iter; left time: 894.2262s
	iters: 1400, epoch: 2 | loss: 1.5070959
	speed: 0.0303s/iter; left time: 892.0499s
	iters: 1500, epoch: 2 | loss: 1.4445343
	speed: 0.0299s/iter; left time: 878.3115s
	iters: 1600, epoch: 2 | loss: 1.5912600
	speed: 0.0304s/iter; left time: 889.1836s
	iters: 1700, epoch: 2 | loss: 1.8439373
	speed: 0.0305s/iter; left time: 888.5163s
	iters: 1800, epoch: 2 | loss: 1.5040270
	speed: 0.0306s/iter; left time: 887.3669s
	iters: 1900, epoch: 2 | loss: 1.6213146
	speed: 0.0305s/iter; left time: 881.9826s
	iters: 2000, epoch: 2 | loss: 1.4897492
	speed: 0.0301s/iter; left time: 866.4514s
	iters: 2100, epoch: 2 | loss: 1.5884113
	speed: 0.0302s/iter; left time: 868.3205s
	iters: 2200, epoch: 2 | loss: 1.5600691
	speed: 0.0304s/iter; left time: 870.1286s
	iters: 2300, epoch: 2 | loss: 1.5650926
	speed: 0.0304s/iter; left time: 867.6437s
	iters: 2400, epoch: 2 | loss: 1.6819652
	speed: 0.0304s/iter; left time: 865.2152s
	iters: 2500, epoch: 2 | loss: 1.7187186
	speed: 0.0304s/iter; left time: 861.2563s
	iters: 2600, epoch: 2 | loss: 1.7691249
	speed: 0.0302s/iter; left time: 853.6214s
	iters: 2700, epoch: 2 | loss: 1.5450888
	speed: 0.0304s/iter; left time: 855.1327s
	iters: 2800, epoch: 2 | loss: 1.5980064
	speed: 0.0304s/iter; left time: 852.9820s
	iters: 2900, epoch: 2 | loss: 1.4371661
	speed: 0.0304s/iter; left time: 848.4185s
	iters: 3000, epoch: 2 | loss: 1.6222667
	speed: 0.0304s/iter; left time: 846.0014s
	iters: 3100, epoch: 2 | loss: 1.5398885
	speed: 0.0307s/iter; left time: 851.4034s
	iters: 3200, epoch: 2 | loss: 1.4792134
	speed: 0.0303s/iter; left time: 836.8166s
	iters: 3300, epoch: 2 | loss: 1.4447491
	speed: 0.0304s/iter; left time: 837.8308s
	iters: 3400, epoch: 2 | loss: 1.6093003
	speed: 0.0304s/iter; left time: 834.1820s
Epoch: 2 cost time: 104.08941340446472
Epoch: 2, Steps: 3425 | Train Loss: 1.6095098 Vali Loss: 2.0093644 Test Loss: 2.1748273
EarlyStopping counter: 1 out of 3
Updating learning rate to 0.0005
	iters: 100, epoch: 3 | loss: 1.5947176
	speed: 0.2355s/iter; left time: 6428.7337s
	iters: 200, epoch: 3 | loss: 1.6894754
	speed: 0.0304s/iter; left time: 827.6385s
	iters: 300, epoch: 3 | loss: 1.6245229
	speed: 0.0303s/iter; left time: 819.8493s
	iters: 400, epoch: 3 | loss: 1.3891779
	speed: 0.0304s/iter; left time: 819.8418s
	iters: 500, epoch: 3 | loss: 1.4669925
	speed: 0.0304s/iter; left time: 817.9795s
	iters: 600, epoch: 3 | loss: 1.5897465
	speed: 0.0304s/iter; left time: 814.2840s
	iters: 700, epoch: 3 | loss: 1.4899806
	speed: 0.0304s/iter; left time: 811.8592s
	iters: 800, epoch: 3 | loss: 1.6325500
	speed: 0.0304s/iter; left time: 807.5262s
	iters: 900, epoch: 3 | loss: 1.6974906
	speed: 0.0304s/iter; left time: 805.8681s
	iters: 1000, epoch: 3 | loss: 1.8307043
	speed: 0.0304s/iter; left time: 802.1449s
	iters: 1100, epoch: 3 | loss: 1.4569045
	speed: 0.0304s/iter; left time: 799.1652s
	iters: 1200, epoch: 3 | loss: 1.6386272
	speed: 0.0304s/iter; left time: 796.3771s
	iters: 1300, epoch: 3 | loss: 1.6974666
	speed: 0.0304s/iter; left time: 793.1052s
	iters: 1400, epoch: 3 | loss: 1.5470815
	speed: 0.0304s/iter; left time: 789.9250s
	iters: 1500, epoch: 3 | loss: 1.4623250
	speed: 0.0303s/iter; left time: 785.3732s
	iters: 1600, epoch: 3 | loss: 1.6922088
	speed: 0.0305s/iter; left time: 787.1774s
	iters: 1700, epoch: 3 | loss: 1.7141783
	speed: 0.0305s/iter; left time: 784.9855s
	iters: 1800, epoch: 3 | loss: 1.5025817
	speed: 0.0304s/iter; left time: 777.9139s
	iters: 1900, epoch: 3 | loss: 1.5625786
	speed: 0.0304s/iter; left time: 774.2896s
	iters: 2000, epoch: 3 | loss: 1.4270262
	speed: 0.0304s/iter; left time: 771.8249s
	iters: 2100, epoch: 3 | loss: 1.5957479
	speed: 0.0303s/iter; left time: 765.4670s
	iters: 2200, epoch: 3 | loss: 1.8832009
	speed: 0.0305s/iter; left time: 768.7922s
	iters: 2300, epoch: 3 | loss: 1.5412600
	speed: 0.0304s/iter; left time: 763.0293s
	iters: 2400, epoch: 3 | loss: 1.5274060
	speed: 0.0304s/iter; left time: 759.8565s
	iters: 2500, epoch: 3 | loss: 1.4750788
	speed: 0.0303s/iter; left time: 754.6679s
	iters: 2600, epoch: 3 | loss: 1.5987990
	speed: 0.0304s/iter; left time: 753.6468s
	iters: 2700, epoch: 3 | loss: 1.7033833
	speed: 0.0303s/iter; left time: 748.0395s
	iters: 2800, epoch: 3 | loss: 1.4531083
	speed: 0.0306s/iter; left time: 752.1322s
	iters: 2900, epoch: 3 | loss: 1.4562601
	speed: 0.0304s/iter; left time: 745.2026s
	iters: 3000, epoch: 3 | loss: 1.6700697
	speed: 0.0304s/iter; left time: 741.7101s
	iters: 3100, epoch: 3 | loss: 1.5663060
	speed: 0.0308s/iter; left time: 747.6690s
	iters: 3200, epoch: 3 | loss: 1.6772689
	speed: 0.0304s/iter; left time: 735.6809s
	iters: 3300, epoch: 3 | loss: 1.4832391
	speed: 0.0302s/iter; left time: 726.7089s
	iters: 3400, epoch: 3 | loss: 1.7694513
	speed: 0.0304s/iter; left time: 729.4828s
Epoch: 3 cost time: 104.19142460823059
Epoch: 3, Steps: 3425 | Train Loss: 1.6188599 Vali Loss: 2.0063486 Test Loss: 2.1742363
EarlyStopping counter: 2 out of 3
Updating learning rate to 0.00025
	iters: 100, epoch: 4 | loss: 1.6859335
	speed: 0.2350s/iter; left time: 5610.9284s
	iters: 200, epoch: 4 | loss: 1.7280080
	speed: 0.0304s/iter; left time: 722.4792s
	iters: 300, epoch: 4 | loss: 1.7217616
	speed: 0.0303s/iter; left time: 716.2398s
	iters: 400, epoch: 4 | loss: 1.5237212
	speed: 0.0302s/iter; left time: 712.9126s
	iters: 500, epoch: 4 | loss: 1.4744139
	speed: 0.0304s/iter; left time: 714.6118s
	iters: 600, epoch: 4 | loss: 1.5790948
	speed: 0.0302s/iter; left time: 705.1754s
	iters: 700, epoch: 4 | loss: 1.6380510
	speed: 0.0304s/iter; left time: 707.4707s
	iters: 800, epoch: 4 | loss: 1.8678364
	speed: 0.0302s/iter; left time: 700.1207s
	iters: 900, epoch: 4 | loss: 1.2971690
	speed: 0.0303s/iter; left time: 699.1991s
	iters: 1000, epoch: 4 | loss: 1.5608571
	speed: 0.0305s/iter; left time: 700.2806s
	iters: 1100, epoch: 4 | loss: 1.4081278
	speed: 0.0303s/iter; left time: 692.6254s
	iters: 1200, epoch: 4 | loss: 1.8594207
	speed: 0.0304s/iter; left time: 692.8683s
	iters: 1300, epoch: 4 | loss: 1.5668108
	speed: 0.0302s/iter; left time: 683.7762s
	iters: 1400, epoch: 4 | loss: 1.3876855
	speed: 0.0304s/iter; left time: 685.6037s
	iters: 1500, epoch: 4 | loss: 1.7300631
	speed: 0.0304s/iter; left time: 683.1083s
	iters: 1600, epoch: 4 | loss: 1.6106008
	speed: 0.0304s/iter; left time: 679.7194s
	iters: 1700, epoch: 4 | loss: 1.5865231
	speed: 0.0303s/iter; left time: 675.4175s
	iters: 1800, epoch: 4 | loss: 1.6013905
	speed: 0.0303s/iter; left time: 671.1384s
	iters: 1900, epoch: 4 | loss: 1.5675817
	speed: 0.0304s/iter; left time: 671.5270s
	iters: 2000, epoch: 4 | loss: 1.6882703
	speed: 0.0305s/iter; left time: 669.6988s
	iters: 2100, epoch: 4 | loss: 1.3959837
	speed: 0.0304s/iter; left time: 664.6661s
	iters: 2200, epoch: 4 | loss: 1.6813972
	speed: 0.0304s/iter; left time: 661.4677s
	iters: 2300, epoch: 4 | loss: 1.7548262
	speed: 0.0304s/iter; left time: 658.5840s
	iters: 2400, epoch: 4 | loss: 1.6148803
	speed: 0.0304s/iter; left time: 655.1855s
	iters: 2500, epoch: 4 | loss: 1.5063049
	speed: 0.0304s/iter; left time: 652.1613s
	iters: 2600, epoch: 4 | loss: 1.6777390
	speed: 0.0303s/iter; left time: 647.0952s
	iters: 2700, epoch: 4 | loss: 1.5624095
	speed: 0.0303s/iter; left time: 644.4894s
	iters: 2800, epoch: 4 | loss: 1.6938781
	speed: 0.0304s/iter; left time: 643.6077s
	iters: 2900, epoch: 4 | loss: 1.5393579
	speed: 0.0304s/iter; left time: 640.6120s
	iters: 3000, epoch: 4 | loss: 1.6384703
	speed: 0.0304s/iter; left time: 637.9599s
	iters: 3100, epoch: 4 | loss: 1.5024575
	speed: 0.0307s/iter; left time: 640.9297s
	iters: 3200, epoch: 4 | loss: 1.6417924
	speed: 0.0304s/iter; left time: 631.4922s
	iters: 3300, epoch: 4 | loss: 1.7131355
	speed: 0.0304s/iter; left time: 628.0709s
	iters: 3400, epoch: 4 | loss: 1.6639867
	speed: 0.0305s/iter; left time: 627.0833s
Epoch: 4 cost time: 104.0412609577179
Epoch: 4, Steps: 3425 | Train Loss: 1.6187077 Vali Loss: 2.0064585 Test Loss: 2.1741590
EarlyStopping counter: 3 out of 3
Early stopping
>>>>>>>testing : long_term_forecast_pems05_all_96_336_iTransformer_custom_ftM_sl96_ll48_pl336_dm512_nh8_el4_dl1_df512_fc3_ebtimeF_dtTrue_srate0.1_sseed7_trainseed2024_gap730_Exp_0<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
test 42355
test shape: (4235, 1, 336, 103) (4235, 1, 336, 103)
test shape: (4235, 336, 103) (4235, 336, 103)
mse:2.206936836242676, mae:1.2011576890945435
>>>>>>>Overall time: 566 seconds<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<<
